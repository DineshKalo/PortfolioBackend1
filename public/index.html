<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio CMS Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .admin-panel {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
        }
        
        h1, h2, h3 {
            color: #333;
            margin-bottom: 20px;
        }
        
        h1 {
            text-align: center;
            color: #667eea;
        }
        
        h3 {
            color: #667eea;
            font-size: 18px;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .add-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px dashed #667eea;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        input[type="file"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 8px 16px;
            font-size: 12px;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-left: 10px;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .current-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .current-label {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
            display: block;
        }
        
        .item-list {
            margin-top: 20px;
        }
        
        .item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: start;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .item-content {
            flex: 1;
        }
        
        .item-content strong {
            display: block;
            color: #333;
            margin-bottom: 5px;
        }
        
        .item-content small {
            color: #666;
            display: block;
            margin-top: 5px;
        }
        
        .item-meta {
            color: #999;
            font-size: 12px;
            margin-top: 8px;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
            margin-left: 15px;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .gallery-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background: white;
        }
        
        .gallery-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .gallery-item-info {
            padding: 10px;
        }
        
        .gallery-item-caption {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .gallery-item-order {
            font-size: 11px;
            color: #999;
        }
        
        .gallery-item-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .message {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.show {
            display: block;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .hidden {
            display: none;
        }
        
        .link {
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .link:hover {
            color: #5568d3;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
            background: white;
            border-radius: 8px;
            border: 2px dashed #ddd;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .item {
                flex-direction: column;
            }
            
            .item-actions {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div class="login-container" id="loginContainer">
            <h1>Portfolio CMS Login</h1>
            <div class="message" id="loginMessage"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Login</button>
                <p style="text-align: center; margin-top: 15px;">
                    <span class="link" onclick="showForgotPassword()">Forgot Password?</span>
                </p>
            </form>
        </div>

        <!-- Forgot Password Form -->
        <div class="login-container hidden" id="forgotContainer">
            <h1>Reset Password</h1>
            <div class="message" id="forgotMessage"></div>
            <form id="forgotForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="forgotEmail" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Send Reset Link</button>
                <p style="text-align: center; margin-top: 15px;">
                    <span class="link" onclick="showLogin()">Back to Login</span>
                </p>
            </form>
        </div>

        <!-- Reset Password Form (with token) -->
        <div class="login-container hidden" id="resetContainer">
            <h1>Set New Password</h1>
            <div class="message" id="resetMessage"></div>
            <form id="resetForm">
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="resetPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" id="resetPasswordConfirm" required minlength="6">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Reset Password</button>
            </form>
        </div>

        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel">
            <div class="header">
                <h1>Portfolio CMS Admin</h1>
                <button class="btn btn-danger" onclick="logout()">Logout</button>
            </div>

            <div class="message" id="adminMessage"></div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('about')">About</button>
                <button class="tab" onclick="showTab('experience')">Experience</button>
                <button class="tab" onclick="showTab('testimonials')">Testimonials</button>
                <button class="tab" onclick="showTab('gallery')">Gallery</button>
                <button class="tab" onclick="showTab('contact')">Contact</button>
            </div>

            <!-- About Tab -->
            <div class="tab-content active" id="aboutTab">
                <div class="section">
                    <h2>About Section</h2>
                    
                    <h3>Current About Content</h3>
                    <div class="current-content">
                        <span class="current-label">Current Content:</span>
                        <div id="currentAbout" style="color: #666; white-space: pre-wrap;"></div>
                    </div>

                    <h3>Update About Content</h3>
                    <div class="add-form">
                        <form id="aboutForm">
                            <div class="form-group">
                                <label>Content</label>
                                <textarea id="aboutContent" placeholder="Enter about section content..."></textarea>
                            </div>
                            <button type="submit" class="btn btn-success">Save About</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Experience Tab -->
            <div class="tab-content" id="experienceTab">
                <div class="section">
                    <h2>Experience & Certifications</h2>
                    
                    <h3>Add New Experience</h3>
                    <div class="add-form">
                        <form id="experienceForm">
                            <input type="hidden" id="expId">
                            <div class="form-group">
                                <label>Name *</label>
                                <input type="text" id="expName" placeholder="e.g., Bachelor of Science in Computer Science" required>
                            </div>
                            <div class="form-group">
                                <label>Date</label>
                                <input type="date" id="expDate">
                            </div>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="expInProgress" onchange="toggleDate()">
                                <label style="margin: 0;">In Progress</label>
                            </div>
                            <div class="form-group">
                                <label>Display Order</label>
                                <input type="number" id="expOrder" value="0" placeholder="0 = first">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success" id="expSubmitBtn">Add Experience</button>
                                <button type="button" class="btn btn-secondary hidden" id="cancelExpEdit" onclick="cancelEdit('experience')">Cancel</button>
                            </div>
                        </form>
                    </div>

                    <h3>All Experiences (<span id="expCount">0</span>)</h3>
                    <div class="item-list" id="experienceList"></div>
                </div>
            </div>

            <!-- Testimonials Tab -->
            <div class="tab-content" id="testimonialsTab">
                <div class="section">
                    <h2>Client Testimonials</h2>
                    
                    <h3>Add New Testimonial</h3>
                    <div class="add-form">
                        <form id="testimonialForm">
                            <input type="hidden" id="testId">
                            <div class="form-group">
                                <label>Client Name *</label>
                                <input type="text" id="testName" placeholder="e.g., John Doe" required>
                            </div>
                            <div class="form-group">
                                <label>Comment/Review *</label>
                                <textarea id="testComment" placeholder="Enter client testimonial..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label>Activity/Package</label>
                                <input type="text" id="testPackage" placeholder="e.g., Website Development Package">
                            </div>
                            <div class="form-group">
                                <label>Display Order</label>
                                <input type="number" id="testOrder" value="0" placeholder="0 = first">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success" id="testSubmitBtn">Add Testimonial</button>
                                <button type="button" class="btn btn-secondary hidden" id="cancelTestEdit" onclick="cancelEdit('testimonial')">Cancel</button>
                            </div>
                        </form>
                    </div>

                    <h3>All Testimonials (<span id="testCount">0</span>)</h3>
                    <div class="item-list" id="testimonialList"></div>
                </div>
            </div>

            <!-- Gallery Tab -->
            <div class="tab-content" id="galleryTab">
                <div class="section">
                    <h2>Gallery</h2>
                    
                    <h3>Upload New Image</h3>
                    <div class="add-form">
                        <form id="galleryForm">
                            <div class="form-group">
                                <label>Select Image (Max 5MB) *</label>
                                <input type="file" id="galleryImage" accept="image/*" required>
                            </div>
                            <div class="form-group">
                                <label>Caption (Optional)</label>
                                <input type="text" id="galleryCaption" placeholder="Enter image caption...">
                            </div>
                            <div class="form-group">
                                <label>Display Order</label>
                                <input type="number" id="galleryOrder" value="0" placeholder="0 = first">
                            </div>
                            <button type="submit" class="btn btn-success">Upload Image</button>
                        </form>
                    </div>

                    <h3>All Images (<span id="galleryCount">0</span>)</h3>
                    <div class="gallery-grid" id="galleryGrid"></div>
                </div>
            </div>

            <!-- Contact Tab -->
            <div class="tab-content" id="contactTab">
                <div class="section">
                    <h2>Contact Information</h2>
                    
                    <h3>Current Contact Details</h3>
                    <div class="current-content">
                        <div id="currentContact" style="color: #666;"></div>
                    </div>

                    <h3>Update Contact Information</h3>
                    <div class="add-form">
                        <form id="contactForm">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="contactName" placeholder="Your full name">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="contactEmail" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label>Instagram Handle</label>
                                <input type="text" id="contactInsta" placeholder="@username">
                            </div>
                            <button type="submit" class="btn btn-success">Save Contact Info</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/api';
        let token = localStorage.getItem('adminToken');

        // Check for reset token in URL
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const resetToken = urlParams.get('token');
            if (resetToken) {
                showResetPassword(resetToken);
            } else if (token) {
                showAdminPanel();
            }
        });

        // Show/Hide Functions
        function showLogin() {
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('forgotContainer').classList.add('hidden');
            document.getElementById('resetContainer').classList.add('hidden');
        }

        function showForgotPassword() {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('forgotContainer').classList.remove('hidden');
        }

        function showResetPassword(resetToken) {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('resetContainer').classList.remove('hidden');
            document.getElementById('resetContainer').dataset.token = resetToken;
        }

        function showAdminPanel() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('forgotContainer').style.display = 'none';
            document.getElementById('resetContainer').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            loadAllData();
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function showMessage(elementId, message, isError = false) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = 'message show ' + (isError ? 'error' : 'success');
            setTimeout(() => el.classList.remove('show'), 5000);
        }

        // Auth Functions
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();

                if (res.ok) {
                    token = data.token;
                    localStorage.setItem('adminToken', token);
                    showAdminPanel();
                } else {
                    showMessage('loginMessage', data.message, true);
                }
            } catch (error) {
                showMessage('loginMessage', 'Login failed', true);
            }
        });

        document.getElementById('forgotForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;

            try {
                const res = await fetch(`${API_URL}/auth/forgot-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                const data = await res.json();
                showMessage('forgotMessage', data.message, !res.ok);
            } catch (error) {
                showMessage('forgotMessage', 'Request failed', true);
            }
        });

        document.getElementById('resetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('resetPassword').value;
            const confirm = document.getElementById('resetPasswordConfirm').value;
            const resetToken = document.getElementById('resetContainer').dataset.token;

            if (password !== confirm) {
                showMessage('resetMessage', 'Passwords do not match', true);
                return;
            }

            try {
                const res = await fetch(`${API_URL}/auth/reset-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: resetToken, newPassword: password })
                });
                const data = await res.json();

                if (res.ok) {
                    showMessage('resetMessage', data.message + ' Redirecting to login...', false);
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                } else {
                    showMessage('resetMessage', data.message, true);
                }
            } catch (error) {
                showMessage('resetMessage', 'Reset failed', true);
            }
        });

        function logout() {
            localStorage.removeItem('adminToken');
            token = null;
            window.location.reload();
        }

        // API Helper
        async function apiCall(endpoint, method = 'GET', body = null, isFormData = false) {
            const headers = { 'Authorization': `Bearer ${token}` };
            if (!isFormData) headers['Content-Type'] = 'application/json';

            const options = { method, headers };
            if (body) options.body = isFormData ? body : JSON.stringify(body);

            const res = await fetch(`${API_URL}${endpoint}`, options);
            if (res.status === 401) {
                logout();
                return;
            }
            return res.json();
        }

        // Load All Data
        async function loadAllData() {
            loadAbout();
            loadExperiences();
            loadTestimonials();
            loadGallery();
            loadContact();
        }

        // About Functions
        async function loadAbout() {
            const data = await fetch(`${API_URL}/about`).then(r => r.json());
            const content = data.content || 'No content yet';
            document.getElementById('currentAbout').textContent = content;
            document.getElementById('aboutContent').value = data.content || '';
        }

        document.getElementById('aboutForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const content = document.getElementById('aboutContent').value;
            const data = await apiCall('/about', 'PUT', { content });
            showMessage('adminMessage', data.message);
            loadAbout();
        });

        // Experience Functions
        async function loadExperiences() {
            const data = await fetch(`${API_URL}/experience`).then(r => r.json());
            const list = document.getElementById('experienceList');
            document.getElementById('expCount').textContent = data.length;
            
            if (data.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><p>No experiences added yet. Add your first experience above!</p></div>';
                return;
            }
            
            list.innerHTML = data.map(exp => `
                <div class="item">
                    <div class="item-content">
                        <strong>${exp.name}</strong>
                        ${exp.inProgress ? '<span class="badge badge-warning">In Progress</span>' : ''}
                        <small>${exp.inProgress ? 'In Progress' : (exp.date || 'No date specified')}</small>
                        <div class="item-meta">Order: ${exp.order} | Added: ${new Date(exp.createdAt).toLocaleDateString()}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-small" onclick='editExperience(${JSON.stringify(exp).replace(/'/g, "&apos;")})'>Edit</button>
                        <button class="btn btn-danger btn-small" onclick="deleteExperience('${exp._id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function toggleDate() {
            const checkbox = document.getElementById('expInProgress');
            const dateInput = document.getElementById('expDate');
            dateInput.disabled = checkbox.checked;
            if (checkbox.checked) dateInput.value = '';
        }

        document.getElementById('experienceForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('expId').value;
            const exp = {
                name: document.getElementById('expName').value,
                date: document.getElementById('expDate').value,
                inProgress: document.getElementById('expInProgress').checked,
                order: parseInt(document.getElementById('expOrder').value)
            };

            const data = id 
                ? await apiCall(`/experience/${id}`, 'PUT', exp)
                : await apiCall('/experience', 'POST', exp);

            showMessage('adminMessage', data.message);
            e.target.reset();
            document.getElementById('expId').value = '';
            document.getElementById('expSubmitBtn').textContent = 'Add Experience';
            document.getElementById('cancelExpEdit').classList.add('hidden');
            loadExperiences();
        });

        function editExperience(exp) {
            document.getElementById('expId').value = exp._id;
            document.getElementById('expName').value = exp.name;
            document.getElementById('expDate').value = exp.date || '';
            document.getElementById('expInProgress').checked = exp.inProgress;
            document.getElementById('expOrder').value = exp.order;
            document.getElementById('expSubmitBtn').textContent = 'Update Experience';
            document.getElementById('cancelExpEdit').classList.remove('hidden');
            toggleDate();
            // Scroll to form
            document.getElementById('experienceForm').scrollIntoView({ behavior: 'smooth' });
        }

        async function deleteExperience(id) {
            if (!confirm('Are you sure you want to delete this experience?')) return;
            const data = await apiCall(`/experience/${id}`, 'DELETE');
            showMessage('adminMessage', data.message);
            loadExperiences();
        }

        function cancelEdit(type) {
            if (type === 'experience') {
                document.getElementById('experienceForm').reset();
                document.getElementById('expId').value = '';
                document.getElementById('expSubmitBtn').textContent = 'Add Experience';
                document.getElementById('cancelExpEdit').classList.add('hidden');
            } else {
                document.getElementById('testimonialForm').reset();
                document.getElementById('testId').value = '';
                document.getElementById('testSubmitBtn').textContent = 'Add Testimonial';
                document.getElementById('cancelTestEdit').classList.add('hidden');
            }
        }

        // Testimonial Functions
        async function loadTestimonials() {
            const data = await fetch(`${API_URL}/testimonial`).then(r => r.json());
            const list = document.getElementById('testimonialList');
            document.getElementById('testCount').textContent = data.length;
            
            if (data.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí¨</div><p>No testimonials added yet. Add your first testimonial above!</p></div>';
                return;
            }
            
            list.innerHTML = data.map(test => `
                <div class="item">
                    <div class="item-content">
                        <strong>${test.name}</strong>
                        ${test.activityPackage ? `<span class="badge badge-success">${test.activityPackage}</span>` : ''}
                        <small>"${test.comment}"</small>
                        <div class="item-meta">Order: ${test.order} | Added: ${new Date(test.createdAt).toLocaleDateString()}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-small" onclick='editTestimonial(${JSON.stringify(test).replace(/'/g, "&apos;")})'>Edit</button>
                        <button class="btn btn-danger btn-small" onclick="deleteTestimonial('${test._id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('testimonialForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('testId').value;
            const test = {
                name: document.getElementById('testName').value,
                comment: document.getElementById('testComment').value,
                activityPackage: document.getElementById('testPackage').value,
                order: parseInt(document.getElementById('testOrder').value)
            };

            const data = id 
                ? await apiCall(`/testimonial/${id}`, 'PUT', test)
                : await apiCall('/testimonial', 'POST', test);

            showMessage('adminMessage', data.message);
            e.target.reset();
            document.getElementById('testId').value = '';
            document.getElementById('testSubmitBtn').textContent = 'Add Testimonial';
            document.getElementById('cancelTestEdit').classList.add('hidden');
            loadTestimonials();
        });

        function editTestimonial(test) {
            document.getElementById('testId').value = test._id;
            document.getElementById('testName').value = test.name;
            document.getElementById('testComment').value = test.comment;
            document.getElementById('testPackage').value = test.activityPackage || '';
            document.getElementById('testOrder').value = test.order;
            document.getElementById('testSubmitBtn').textContent = 'Update Testimonial';
            document.getElementById('cancelTestEdit').classList.remove('hidden');
            // Scroll to form
            document.getElementById('testimonialForm').scrollIntoView({ behavior: 'smooth' });
        }

        async function deleteTestimonial(id) {
            if (!confirm('Are you sure you want to delete this testimonial?')) return;
            const data = await apiCall(`/testimonial/${id}`, 'DELETE');
            showMessage('adminMessage', data.message);
            loadTestimonials();
        }

        // Gallery Functions
        async function loadGallery() {
            const data = await fetch(`${API_URL}/gallery`).then(r => r.json());
            const grid = document.getElementById('galleryGrid');
            document.getElementById('galleryCount').textContent = data.length;
            
            if (data.length === 0) {
                grid.innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><div class="empty-state-icon">üñºÔ∏è</div><p>No images uploaded yet. Upload your first image above!</p></div>';
                return;
            }
            
            grid.innerHTML = data.map(img => `
                <div class="gallery-item">
                    <img src="${img.imageUrl}" alt="${img.caption || 'Gallery image'}">
                    <div class="gallery-item-info">
                        <div class="gallery-item-caption">${img.caption || 'No caption'}</div>
                        <div class="gallery-item-order">Order: ${img.order} | ${new Date(img.createdAt).toLocaleDateString()}</div>
                    </div>
                    <div class="gallery-item-actions">
                        <button class="btn btn-danger btn-small" onclick="deleteImage('${img._id}')" title="Delete image">√ó</button>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('galleryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('galleryImage');
            
            if (!fileInput.files[0]) {
                showMessage('adminMessage', 'Please select an image', true);
                return;
            }
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            formData.append('caption', document.getElementById('galleryCaption').value);
            formData.append('order', document.getElementById('galleryOrder').value);

            // Show uploading message
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Uploading...';
            submitBtn.disabled = true;

            try {
                const data = await apiCall('/gallery', 'POST', formData, true);
                showMessage('adminMessage', data.message);
                e.target.reset();
                loadGallery();
            } catch (error) {
                showMessage('adminMessage', 'Upload failed', true);
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        async function deleteImage(id) {
            if (!confirm('Are you sure you want to delete this image? This will also remove it from Cloudinary.')) return;
            const data = await apiCall(`/gallery/${id}`, 'DELETE');
            showMessage('adminMessage', data.message);
            loadGallery();
        }

        // Contact Functions
        async function loadContact() {
            const data = await fetch(`${API_URL}/contact`).then(r => r.json());
            
            // Display current contact
            const currentContact = document.getElementById('currentContact');
            if (!data.name && !data.email && !data.instagramHandle) {
                currentContact.innerHTML = '<p style="color: #999;">No contact information set yet.</p>';
            } else {
                currentContact.innerHTML = `
                    <p><strong>Name:</strong> ${data.name || 'Not set'}</p>
                    <p><strong>Email:</strong> ${data.email || 'Not set'}</p>
                    <p><strong>Instagram:</strong> ${data.instagramHandle || 'Not set'}</p>
                `;
            }
            
            // Fill form
            document.getElementById('contactName').value = data.name || '';
            document.getElementById('contactEmail').value = data.email || '';
            document.getElementById('contactInsta').value = data.instagramHandle || '';
        }

        document.getElementById('contactForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const contact = {
                name: document.getElementById('contactName').value,
                email: document.getElementById('contactEmail').value,
                instagramHandle: document.getElementById('contactInsta').value
            };
            const data = await apiCall('/contact', 'PUT', contact);
            showMessage('adminMessage', data.message);
            loadContact();
        });
    </script>
</body>
</html>